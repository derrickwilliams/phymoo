{"version":3,"sources":["/Users/derwilliams/workspace/me/projects/phymoo/www/lib/localforage/src/drivers/indexeddb.js"],"names":[],"mappings":";;;;AAEA,CAAC,YAAW;AACR,gBAAY,CAAC;;;;;AAKb,QAAI,OAAO,GAAG,AAAC,OAAO,MAAM,KAAK,WAAW,IAAI,MAAM,CAAC,OAAO,IAAI,OAAO,OAAO,KAAK,WAAW,GAClF,OAAO,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC;;;AAGhD,QAAI,SAAS,GAAG,SAAS,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,eAAe,IACnD,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,UAAU,IACpC,IAAI,CAAC,WAAW,CAAC;;;AAGjC,QAAI,CAAC,SAAS,EAAE;AACZ,eAAO;KACV;;;;AAID,aAAS,YAAY,CAAC,OAAO,EAAE;AAC3B,YAAI,IAAI,GAAG,IAAI,CAAC;AAChB,YAAI,MAAM,GAAG;AACT,cAAE,EAAE,IAAI;SACX,CAAC;;AAEF,YAAI,OAAO,EAAE;AACT,iBAAK,IAAI,CAAC,IAAI,OAAO,EAAE;AACnB,sBAAM,CAAC,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;aAC1B;SACJ;;AAED,eAAO,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AACzC,gBAAI,OAAO,GAAG,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC;AAC1D,mBAAO,CAAC,OAAO,GAAG,YAAW;AACzB,sBAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;aACzB,CAAC;AACF,mBAAO,CAAC,eAAe,GAAG,YAAW;;AAEjC,uBAAO,CAAC,MAAM,CAAC,iBAAiB,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;aACtD,CAAC;AACF,mBAAO,CAAC,SAAS,GAAG,YAAW;AAC3B,sBAAM,CAAC,EAAE,GAAG,OAAO,CAAC,MAAM,CAAC;AAC3B,oBAAI,CAAC,OAAO,GAAG,MAAM,CAAC;AACtB,uBAAO,EAAE,CAAC;aACb,CAAC;SACL,CAAC,CAAC;KACN;;AAED,aAAS,OAAO,CAAC,GAAG,EAAE,QAAQ,EAAE;AAC5B,YAAI,IAAI,GAAG,IAAI,CAAC;;;AAGhB,YAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;AACzB,kBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,GACH,yCAAyC,CAAC,CAAC;AAC/D,eAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;SACrB;;AAED,YAAI,OAAO,GAAG,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AAChD,gBAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,YAAW;AACzB,oBAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AAC1B,oBAAI,KAAK,GAAG,MAAM,CAAC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,UAAU,CAAC,CAC1D,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AACnC,oBAAI,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;;AAEzB,mBAAG,CAAC,SAAS,GAAG,YAAW;AACvB,wBAAI,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC;AACvB,wBAAI,KAAK,KAAK,SAAS,EAAE;AACrB,6BAAK,GAAG,IAAI,CAAC;qBAChB;;AAED,2BAAO,CAAC,KAAK,CAAC,CAAC;iBAClB,CAAC;;AAEF,mBAAG,CAAC,OAAO,GAAG,YAAW;AACrB,0BAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;iBACrB,CAAC;aACL,CAAC,SAAM,CAAC,MAAM,CAAC,CAAC;SACpB,CAAC,CAAC;;AAEH,uBAAe,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;AACnC,eAAO,OAAO,CAAC;KAClB;;;AAGD,aAAS,OAAO,CAAC,QAAQ,EAAE,QAAQ,EAAE;AACjC,YAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,YAAI,OAAO,GAAG,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AAChD,gBAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,YAAW;AACzB,oBAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AAC1B,oBAAI,KAAK,GAAG,MAAM,CAAC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,UAAU,CAAC,CACzC,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;;AAEpD,oBAAI,GAAG,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC;AAC7B,oBAAI,eAAe,GAAG,CAAC,CAAC;;AAExB,mBAAG,CAAC,SAAS,GAAG,YAAW;AACvB,wBAAI,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;;AAExB,wBAAI,MAAM,EAAE;AACR,4BAAI,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,GAAG,EAAE,eAAe,EAAE,CAAC,CAAC;;AAEnE,4BAAI,MAAM,KAAK,KAAK,CAAC,AAAC,EAAE;AACpB,mCAAO,CAAC,MAAM,CAAC,CAAC;yBACnB,MAAM;AACH,kCAAM,YAAS,EAAE,CAAC;yBACrB;qBACJ,MAAM;AACH,+BAAO,EAAE,CAAC;qBACb;iBACJ,CAAC;;AAEF,mBAAG,CAAC,OAAO,GAAG,YAAW;AACrB,0BAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;iBACrB,CAAC;aACL,CAAC,SAAM,CAAC,MAAM,CAAC,CAAC;SACpB,CAAC,CAAC;;AAEH,uBAAe,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;;AAEnC,eAAO,OAAO,CAAC;KAClB;;AAED,aAAS,OAAO,CAAC,GAAG,EAAE,KAAK,EAAE,QAAQ,EAAE;AACnC,YAAI,IAAI,GAAG,IAAI,CAAC;;;AAGhB,YAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;AACzB,kBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,GACH,yCAAyC,CAAC,CAAC;AAC/D,eAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;SACrB;;AAED,YAAI,OAAO,GAAG,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AAChD,gBAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,YAAW;AACzB,oBAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AAC1B,oBAAI,WAAW,GAAG,MAAM,CAAC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;AACvE,oBAAI,KAAK,GAAG,WAAW,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;;;;;;AAMtD,oBAAI,KAAK,KAAK,IAAI,EAAE;AAChB,yBAAK,GAAG,SAAS,CAAC;iBACrB;;AAED,oBAAI,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;AAChC,2BAAW,CAAC,UAAU,GAAG,YAAW;;;;;;;AAOhC,wBAAI,KAAK,KAAK,SAAS,EAAE;AACrB,6BAAK,GAAG,IAAI,CAAC;qBAChB;;AAED,2BAAO,CAAC,KAAK,CAAC,CAAC;iBAClB,CAAC;AACF,2BAAW,CAAC,OAAO,GAAG,WAAW,CAAC,OAAO,GAAG,YAAW;AACnD,wBAAI,GAAG,GAAG,GAAG,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,GAAG,GAAG,CAAC,WAAW,CAAC,KAAK,CAAC;AACxD,0BAAM,CAAC,GAAG,CAAC,CAAC;iBACf,CAAC;aACL,CAAC,SAAM,CAAC,MAAM,CAAC,CAAC;SACpB,CAAC,CAAC;;AAEH,uBAAe,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;AACnC,eAAO,OAAO,CAAC;KAClB;;AAED,aAAS,UAAU,CAAC,GAAG,EAAE,QAAQ,EAAE;AAC/B,YAAI,IAAI,GAAG,IAAI,CAAC;;;AAGhB,YAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;AACzB,kBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,GACH,yCAAyC,CAAC,CAAC;AAC/D,eAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;SACrB;;AAED,YAAI,OAAO,GAAG,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AAChD,gBAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,YAAW;AACzB,oBAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AAC1B,oBAAI,WAAW,GAAG,MAAM,CAAC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;AACvE,oBAAI,KAAK,GAAG,WAAW,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;;;;;;;AAOtD,oBAAI,GAAG,GAAG,KAAK,UAAO,CAAC,GAAG,CAAC,CAAC;AAC5B,2BAAW,CAAC,UAAU,GAAG,YAAW;AAChC,2BAAO,EAAE,CAAC;iBACb,CAAC;;AAEF,2BAAW,CAAC,OAAO,GAAG,YAAW;AAC7B,0BAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;iBACrB,CAAC;;;;AAIF,2BAAW,CAAC,OAAO,GAAG,YAAW;AAC7B,wBAAI,GAAG,GAAG,GAAG,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,GAAG,GAAG,CAAC,WAAW,CAAC,KAAK,CAAC;AACxD,0BAAM,CAAC,GAAG,CAAC,CAAC;iBACf,CAAC;aACL,CAAC,SAAM,CAAC,MAAM,CAAC,CAAC;SACpB,CAAC,CAAC;;AAEH,uBAAe,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;AACnC,eAAO,OAAO,CAAC;KAClB;;AAED,aAAS,KAAK,CAAC,QAAQ,EAAE;AACrB,YAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,YAAI,OAAO,GAAG,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AAChD,gBAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,YAAW;AACzB,oBAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AAC1B,oBAAI,WAAW,GAAG,MAAM,CAAC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;AACvE,oBAAI,KAAK,GAAG,WAAW,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AACtD,oBAAI,GAAG,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC;;AAExB,2BAAW,CAAC,UAAU,GAAG,YAAW;AAChC,2BAAO,EAAE,CAAC;iBACb,CAAC;;AAEF,2BAAW,CAAC,OAAO,GAAG,WAAW,CAAC,OAAO,GAAG,YAAW;AACnD,wBAAI,GAAG,GAAG,GAAG,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,GAAG,GAAG,CAAC,WAAW,CAAC,KAAK,CAAC;AACxD,0BAAM,CAAC,GAAG,CAAC,CAAC;iBACf,CAAC;aACL,CAAC,SAAM,CAAC,MAAM,CAAC,CAAC;SACpB,CAAC,CAAC;;AAEH,uBAAe,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;AACnC,eAAO,OAAO,CAAC;KAClB;;AAED,aAAS,MAAM,CAAC,QAAQ,EAAE;AACtB,YAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,YAAI,OAAO,GAAG,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AAChD,gBAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,YAAW;AACzB,oBAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AAC1B,oBAAI,KAAK,GAAG,MAAM,CAAC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,UAAU,CAAC,CAChD,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AAC7C,oBAAI,GAAG,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC;;AAExB,mBAAG,CAAC,SAAS,GAAG,YAAW;AACvB,2BAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;iBACvB,CAAC;;AAEF,mBAAG,CAAC,OAAO,GAAG,YAAW;AACrB,0BAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;iBACrB,CAAC;aACL,CAAC,SAAM,CAAC,MAAM,CAAC,CAAC;SACpB,CAAC,CAAC;;AAEH,uBAAe,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;AACnC,eAAO,OAAO,CAAC;KAClB;;AAED,aAAS,GAAG,CAAC,CAAC,EAAE,QAAQ,EAAE;AACtB,YAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,YAAI,OAAO,GAAG,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AAChD,gBAAI,CAAC,GAAG,CAAC,EAAE;AACP,uBAAO,CAAC,IAAI,CAAC,CAAC;;AAEd,uBAAO;aACV;;AAED,gBAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,YAAW;AACzB,oBAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AAC1B,oBAAI,KAAK,GAAG,MAAM,CAAC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,UAAU,CAAC,CAChD,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;;AAE7C,oBAAI,QAAQ,GAAG,KAAK,CAAC;AACrB,oBAAI,GAAG,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC;AAC7B,mBAAG,CAAC,SAAS,GAAG,YAAW;AACvB,wBAAI,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;AACxB,wBAAI,CAAC,MAAM,EAAE;;AAET,+BAAO,CAAC,IAAI,CAAC,CAAC;;AAEd,+BAAO;qBACV;;AAED,wBAAI,CAAC,KAAK,CAAC,EAAE;;;AAGT,+BAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;qBACvB,MAAM;AACH,4BAAI,CAAC,QAAQ,EAAE;;;AAGX,oCAAQ,GAAG,IAAI,CAAC;AAChB,kCAAM,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;yBACrB,MAAM;;AAEH,mCAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;yBACvB;qBACJ;iBACJ,CAAC;;AAEF,mBAAG,CAAC,OAAO,GAAG,YAAW;AACrB,0BAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;iBACrB,CAAC;aACL,CAAC,SAAM,CAAC,MAAM,CAAC,CAAC;SACpB,CAAC,CAAC;;AAEH,uBAAe,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;AACnC,eAAO,OAAO,CAAC;KAClB;;AAED,aAAS,IAAI,CAAC,QAAQ,EAAE;AACpB,YAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,YAAI,OAAO,GAAG,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AAChD,gBAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,YAAW;AACzB,oBAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AAC1B,oBAAI,KAAK,GAAG,MAAM,CAAC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,UAAU,CAAC,CAChD,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;;AAE7C,oBAAI,GAAG,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC;AAC7B,oBAAI,IAAI,GAAG,EAAE,CAAC;;AAEd,mBAAG,CAAC,SAAS,GAAG,YAAW;AACvB,wBAAI,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;;AAExB,wBAAI,CAAC,MAAM,EAAE;AACT,+BAAO,CAAC,IAAI,CAAC,CAAC;AACd,+BAAO;qBACV;;AAED,wBAAI,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACtB,0BAAM,YAAS,EAAE,CAAC;iBACrB,CAAC;;AAEF,mBAAG,CAAC,OAAO,GAAG,YAAW;AACrB,0BAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;iBACrB,CAAC;aACL,CAAC,SAAM,CAAC,MAAM,CAAC,CAAC;SACpB,CAAC,CAAC;;AAEH,uBAAe,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;AACnC,eAAO,OAAO,CAAC;KAClB;;AAED,aAAS,eAAe,CAAC,OAAO,EAAE,QAAQ,EAAE;AACxC,YAAI,QAAQ,EAAE;AACV,mBAAO,CAAC,IAAI,CAAC,UAAS,MAAM,EAAE;AAC1B,wBAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;aAC1B,EAAE,UAAS,KAAK,EAAE;AACf,wBAAQ,CAAC,KAAK,CAAC,CAAC;aACnB,CAAC,CAAC;SACN;KACJ;;AAED,QAAI,YAAY,GAAG;AACf,eAAO,EAAE,cAAc;AACvB,oBAAY,EAAE,YAAY;AAC1B,eAAO,EAAE,OAAO;AAChB,eAAO,EAAE,OAAO;AAChB,eAAO,EAAE,OAAO;AAChB,kBAAU,EAAE,UAAU;AACtB,aAAK,EAAE,KAAK;AACZ,cAAM,EAAE,MAAM;AACd,WAAG,EAAE,GAAG;AACR,YAAI,EAAE,IAAI;KACb,CAAC;;AAEF,QAAI,OAAO,MAAM,KAAK,WAAW,IAAI,MAAM,CAAC,OAAO,IAAI,OAAO,OAAO,KAAK,WAAW,EAAE;AACnF,cAAM,CAAC,OAAO,GAAG,YAAY,CAAC;KACjC,MAAM,IAAI,OAAO,MAAM,KAAK,UAAU,IAAI,MAAM,CAAC,GAAG,EAAE;AACnD,cAAM,CAAC,cAAc,EAAE,YAAW;AAC9B,mBAAO,YAAY,CAAC;SACvB,CAAC,CAAC;KACN,MAAM;AACH,YAAI,CAAC,YAAY,GAAG,YAAY,CAAC;KACpC;CACJ,CAAA,CAAE,IAAI,CAAC,MAAM,CAAC,CAAC","file":"indexeddb-compiled.js","sourcesContent":["// Some code originally from async_storage.js in\n// [Gaia](https://github.com/mozilla-b2g/gaia).\n(function() {\n    'use strict';\n\n    // Originally found in https://github.com/mozilla-b2g/gaia/blob/e8f624e4cc9ea945727278039b3bc9bcb9f8667a/shared/js/async_storage.js\n\n    // Promises!\n    var Promise = (typeof module !== 'undefined' && module.exports && typeof require !== 'undefined') ?\n                  require('promise') : this.Promise;\n\n    // Initialize IndexedDB; fall back to vendor-prefixed versions if needed.\n    var indexedDB = indexedDB || this.indexedDB || this.webkitIndexedDB ||\n                    this.mozIndexedDB || this.OIndexedDB ||\n                    this.msIndexedDB;\n\n    // If IndexedDB isn't available, we get outta here!\n    if (!indexedDB) {\n        return;\n    }\n\n    // Open the IndexedDB database (automatically creates one if one didn't\n    // previously exist), using any options set in the config.\n    function _initStorage(options) {\n        var self = this;\n        var dbInfo = {\n            db: null\n        };\n\n        if (options) {\n            for (var i in options) {\n                dbInfo[i] = options[i];\n            }\n        }\n\n        return new Promise(function(resolve, reject) {\n            var openreq = indexedDB.open(dbInfo.name, dbInfo.version);\n            openreq.onerror = function() {\n                reject(openreq.error);\n            };\n            openreq.onupgradeneeded = function() {\n                // First time setup: create an empty object store\n                openreq.result.createObjectStore(dbInfo.storeName);\n            };\n            openreq.onsuccess = function() {\n                dbInfo.db = openreq.result;\n                self._dbInfo = dbInfo;\n                resolve();\n            };\n        });\n    }\n\n    function getItem(key, callback) {\n        var self = this;\n\n        // Cast the key to a string, as that's all we can set as a key.\n        if (typeof key !== 'string') {\n            window.console.warn(key +\n                                ' used as a key, but it is not a string.');\n            key = String(key);\n        }\n\n        var promise = new Promise(function(resolve, reject) {\n            self.ready().then(function() {\n                var dbInfo = self._dbInfo;\n                var store = dbInfo.db.transaction(dbInfo.storeName, 'readonly')\n                    .objectStore(dbInfo.storeName);\n                var req = store.get(key);\n\n                req.onsuccess = function() {\n                    var value = req.result;\n                    if (value === undefined) {\n                        value = null;\n                    }\n\n                    resolve(value);\n                };\n\n                req.onerror = function() {\n                    reject(req.error);\n                };\n            }).catch(reject);\n        });\n\n        executeCallback(promise, callback);\n        return promise;\n    }\n\n    // Iterate over all items stored in database.\n    function iterate(iterator, callback) {\n        var self = this;\n\n        var promise = new Promise(function(resolve, reject) {\n            self.ready().then(function() {\n                var dbInfo = self._dbInfo;\n                var store = dbInfo.db.transaction(dbInfo.storeName, 'readonly')\n                                     .objectStore(dbInfo.storeName);\n\n                var req = store.openCursor();\n                var iterationNumber = 1;\n\n                req.onsuccess = function() {\n                    var cursor = req.result;\n\n                    if (cursor) {\n                        var result = iterator(cursor.value, cursor.key, iterationNumber++);\n\n                        if (result !== void(0)) {\n                            resolve(result);\n                        } else {\n                            cursor.continue();\n                        }\n                    } else {\n                        resolve();\n                    }\n                };\n\n                req.onerror = function() {\n                    reject(req.error);\n                };\n            }).catch(reject);\n        });\n\n        executeCallback(promise, callback);\n\n        return promise;\n    }\n\n    function setItem(key, value, callback) {\n        var self = this;\n\n        // Cast the key to a string, as that's all we can set as a key.\n        if (typeof key !== 'string') {\n            window.console.warn(key +\n                                ' used as a key, but it is not a string.');\n            key = String(key);\n        }\n\n        var promise = new Promise(function(resolve, reject) {\n            self.ready().then(function() {\n                var dbInfo = self._dbInfo;\n                var transaction = dbInfo.db.transaction(dbInfo.storeName, 'readwrite');\n                var store = transaction.objectStore(dbInfo.storeName);\n\n                // The reason we don't _save_ null is because IE 10 does\n                // not support saving the `null` type in IndexedDB. How\n                // ironic, given the bug below!\n                // See: https://github.com/mozilla/localForage/issues/161\n                if (value === null) {\n                    value = undefined;\n                }\n\n                var req = store.put(value, key);\n                transaction.oncomplete = function() {\n                    // Cast to undefined so the value passed to\n                    // callback/promise is the same as what one would get out\n                    // of `getItem()` later. This leads to some weirdness\n                    // (setItem('foo', undefined) will return `null`), but\n                    // it's not my fault localStorage is our baseline and that\n                    // it's weird.\n                    if (value === undefined) {\n                        value = null;\n                    }\n\n                    resolve(value);\n                };\n                transaction.onabort = transaction.onerror = function() {\n                    var err = req.error ? req.error : req.transaction.error;\n                    reject(err);\n                };\n            }).catch(reject);\n        });\n\n        executeCallback(promise, callback);\n        return promise;\n    }\n\n    function removeItem(key, callback) {\n        var self = this;\n\n        // Cast the key to a string, as that's all we can set as a key.\n        if (typeof key !== 'string') {\n            window.console.warn(key +\n                                ' used as a key, but it is not a string.');\n            key = String(key);\n        }\n\n        var promise = new Promise(function(resolve, reject) {\n            self.ready().then(function() {\n                var dbInfo = self._dbInfo;\n                var transaction = dbInfo.db.transaction(dbInfo.storeName, 'readwrite');\n                var store = transaction.objectStore(dbInfo.storeName);\n\n                // We use a Grunt task to make this safe for IE and some\n                // versions of Android (including those used by Cordova).\n                // Normally IE won't like `.delete()` and will insist on\n                // using `['delete']()`, but we have a build step that\n                // fixes this for us now.\n                var req = store.delete(key);\n                transaction.oncomplete = function() {\n                    resolve();\n                };\n\n                transaction.onerror = function() {\n                    reject(req.error);\n                };\n\n                // The request will be also be aborted if we've exceeded our storage\n                // space.\n                transaction.onabort = function() {\n                    var err = req.error ? req.error : req.transaction.error;\n                    reject(err);\n                };\n            }).catch(reject);\n        });\n\n        executeCallback(promise, callback);\n        return promise;\n    }\n\n    function clear(callback) {\n        var self = this;\n\n        var promise = new Promise(function(resolve, reject) {\n            self.ready().then(function() {\n                var dbInfo = self._dbInfo;\n                var transaction = dbInfo.db.transaction(dbInfo.storeName, 'readwrite');\n                var store = transaction.objectStore(dbInfo.storeName);\n                var req = store.clear();\n\n                transaction.oncomplete = function() {\n                    resolve();\n                };\n\n                transaction.onabort = transaction.onerror = function() {\n                    var err = req.error ? req.error : req.transaction.error;\n                    reject(err);\n                };\n            }).catch(reject);\n        });\n\n        executeCallback(promise, callback);\n        return promise;\n    }\n\n    function length(callback) {\n        var self = this;\n\n        var promise = new Promise(function(resolve, reject) {\n            self.ready().then(function() {\n                var dbInfo = self._dbInfo;\n                var store = dbInfo.db.transaction(dbInfo.storeName, 'readonly')\n                              .objectStore(dbInfo.storeName);\n                var req = store.count();\n\n                req.onsuccess = function() {\n                    resolve(req.result);\n                };\n\n                req.onerror = function() {\n                    reject(req.error);\n                };\n            }).catch(reject);\n        });\n\n        executeCallback(promise, callback);\n        return promise;\n    }\n\n    function key(n, callback) {\n        var self = this;\n\n        var promise = new Promise(function(resolve, reject) {\n            if (n < 0) {\n                resolve(null);\n\n                return;\n            }\n\n            self.ready().then(function() {\n                var dbInfo = self._dbInfo;\n                var store = dbInfo.db.transaction(dbInfo.storeName, 'readonly')\n                              .objectStore(dbInfo.storeName);\n\n                var advanced = false;\n                var req = store.openCursor();\n                req.onsuccess = function() {\n                    var cursor = req.result;\n                    if (!cursor) {\n                        // this means there weren't enough keys\n                        resolve(null);\n\n                        return;\n                    }\n\n                    if (n === 0) {\n                        // We have the first key, return it if that's what they\n                        // wanted.\n                        resolve(cursor.key);\n                    } else {\n                        if (!advanced) {\n                            // Otherwise, ask the cursor to skip ahead n\n                            // records.\n                            advanced = true;\n                            cursor.advance(n);\n                        } else {\n                            // When we get here, we've got the nth key.\n                            resolve(cursor.key);\n                        }\n                    }\n                };\n\n                req.onerror = function() {\n                    reject(req.error);\n                };\n            }).catch(reject);\n        });\n\n        executeCallback(promise, callback);\n        return promise;\n    }\n\n    function keys(callback) {\n        var self = this;\n\n        var promise = new Promise(function(resolve, reject) {\n            self.ready().then(function() {\n                var dbInfo = self._dbInfo;\n                var store = dbInfo.db.transaction(dbInfo.storeName, 'readonly')\n                              .objectStore(dbInfo.storeName);\n\n                var req = store.openCursor();\n                var keys = [];\n\n                req.onsuccess = function() {\n                    var cursor = req.result;\n\n                    if (!cursor) {\n                        resolve(keys);\n                        return;\n                    }\n\n                    keys.push(cursor.key);\n                    cursor.continue();\n                };\n\n                req.onerror = function() {\n                    reject(req.error);\n                };\n            }).catch(reject);\n        });\n\n        executeCallback(promise, callback);\n        return promise;\n    }\n\n    function executeCallback(promise, callback) {\n        if (callback) {\n            promise.then(function(result) {\n                callback(null, result);\n            }, function(error) {\n                callback(error);\n            });\n        }\n    }\n\n    var asyncStorage = {\n        _driver: 'asyncStorage',\n        _initStorage: _initStorage,\n        iterate: iterate,\n        getItem: getItem,\n        setItem: setItem,\n        removeItem: removeItem,\n        clear: clear,\n        length: length,\n        key: key,\n        keys: keys\n    };\n\n    if (typeof module !== 'undefined' && module.exports && typeof require !== 'undefined') {\n        module.exports = asyncStorage;\n    } else if (typeof define === 'function' && define.amd) {\n        define('asyncStorage', function() {\n            return asyncStorage;\n        });\n    } else {\n        this.asyncStorage = asyncStorage;\n    }\n}).call(window);\n"]}